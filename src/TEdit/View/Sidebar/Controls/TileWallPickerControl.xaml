<UserControl x:Class="TEdit.View.Sidebar.Controls.TileWallPickerControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:cv="clr-namespace:TEdit.Converters"
             xmlns:shared="clr-namespace:TEdit.ViewModel.Shared"
             xmlns:p="clr-namespace:TEdit.Properties"
             mc:Ignorable="d"
             d:DesignHeight="400" d:DesignWidth="350"
             d:DataContext="{d:DesignInstance Type=shared:TileWallPickerViewModel}">
    <UserControl.Resources>
        <cv:TEditColorToMediaColorConverter x:Key="TEditColorToMediaColorConverter" />
        <cv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Search bar with Check/Uncheck All buttons (fixed at top) -->
        <Grid Grid.Row="0" Margin="5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <ui:TextBox Grid.Column="0"
                        PlaceholderText="{x:Static p:Language.settings_search_placeholder}"
                        Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                        Margin="0,0,5,0" />

            <ui:Button Grid.Column="1"
                       Content="{x:Static p:Language.menu_filter_tab_check_all}"
                       ToolTip="{x:Static p:Language.picker_check_all_tooltip}"
                       Command="{Binding CheckAllCommand}"
                       Visibility="{Binding ShowCheckboxes, Converter={StaticResource BoolToVisibilityConverter}}"
                       Margin="0,0,2,0"
                       Padding="8,4" />

            <ui:Button Grid.Column="2"
                       Content="{x:Static p:Language.menu_filter_tab_uncheck_all}"
                       ToolTip="{x:Static p:Language.picker_uncheck_all_tooltip}"
                       Command="{Binding UncheckAllCommand}"
                       Visibility="{Binding ShowCheckboxes, Converter={StaticResource BoolToVisibilityConverter}}"
                       Padding="8,4" />
        </Grid>

        <!-- Virtualized ListBox with color swatches (no external ScrollViewer - ListBox handles its own) -->
        <ListBox Grid.Row="1"
                 ItemsSource="{Binding FilteredItemsView}"
                 VirtualizingPanel.IsVirtualizing="True"
                 VirtualizingPanel.VirtualizationMode="Recycling"
                 VirtualizingPanel.ScrollUnit="Pixel"
                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                 BorderThickness="0"
                 Background="Transparent">
            <ListBox.ItemTemplate>
                <DataTemplate DataType="{x:Type shared:PickerItemViewModel}">
                    <DockPanel Margin="2">
                        <CheckBox DockPanel.Dock="Left"
                                  IsChecked="{Binding IsChecked, Mode=TwoWay}"
                                  Visibility="{Binding DataContext.ShowCheckboxes,
                                               RelativeSource={RelativeSource AncestorType=ListBox},
                                               Converter={StaticResource BoolToVisibilityConverter}}"
                                  VerticalAlignment="Center"
                                  Margin="0,0,4,0" />

                        <!-- Color swatch -->
                        <Border DockPanel.Dock="Left"
                                BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                Margin="0,0,6,0"
                                VerticalAlignment="Center">
                            <Rectangle Height="14" Width="14">
                                <Rectangle.Fill>
                                    <SolidColorBrush Color="{Binding Color,
                                        Converter={StaticResource TEditColorToMediaColorConverter}}" />
                                </Rectangle.Fill>
                            </Rectangle>
                        </Border>

                        <!-- Item ID -->
                        <TextBlock DockPanel.Dock="Right"
                                   Text="{Binding Id, StringFormat='[{0}]'}"
                                   Margin="8,0,4,0"
                                   Foreground="Gray"
                                   VerticalAlignment="Center" />

                        <!-- Item name -->
                        <TextBlock Text="{Binding Name}"
                                   VerticalAlignment="Center"
                                   TextTrimming="CharacterEllipsis"
                                   Foreground="{DynamicResource TextFillColorPrimaryBrush}" />
                    </DockPanel>
                </DataTemplate>
            </ListBox.ItemTemplate>
            <ListBox.ItemContainerStyle>
                <Style TargetType="ListBoxItem" BasedOn="{StaticResource {x:Type ListBoxItem}}">
                    <Setter Property="Padding" Value="4,2" />
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                </Style>
            </ListBox.ItemContainerStyle>
        </ListBox>
    </Grid>
</UserControl>
