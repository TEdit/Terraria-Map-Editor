<UserControl x:Class="TEdit.View.Sidebar.ScriptingSidebarView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:p="clr-namespace:TEdit.Properties"
             xmlns:viewModel="clr-namespace:TEdit.ViewModel"
             xmlns:cv="clr-namespace:TEdit.Converters"
             mc:Ignorable="d"
             d:DesignHeight="700" d:DesignWidth="400"
             d:DataContext="{d:DesignInstance Type=viewModel:ScriptingSidebarViewModel}">

    <UserControl.Resources>
        <cv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </UserControl.Resources>

    <Grid Background="{DynamicResource SidebarBackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>      <!-- Title -->
            <RowDefinition Height="36"/>      <!-- Script selector -->
            <RowDefinition Height="36"/>      <!-- Engine selector -->
            <RowDefinition Height="*"/>         <!-- Code editor -->
            <RowDefinition Height="6"/>      <!-- GridSplitter -->
            <RowDefinition Height="40"/>      <!-- Run/Stop buttons -->
            <RowDefinition Height="Auto"/>      <!-- Progress bar -->
            <RowDefinition Height="180" MinHeight="80"/>  <!-- Output log -->
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock Grid.Row="0"
                   Text="Scripting"
                   Style="{DynamicResource SidebarPanelTitle}"/>

        <!-- Script file selector -->
        <Grid Grid.Row="1" Margin="8,4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <ComboBox Grid.Column="0"
                      ItemsSource="{Binding Scripts}"
                      SelectedValue="{Binding SelectedScriptPath}"
                      SelectedValuePath="FullPath"
                      Height="28"
                      DisplayMemberPath="Name"/>

            <ui:Button Grid.Column="1"
                       Content="New"
                       Command="{Binding NewScriptCommand}"
                       Padding="8,4"
                       Margin="4,0,0,0"
                       ToolTip="New script"/>
            <ui:Button Grid.Column="2"
                       Content="Save"
                       Command="{Binding SaveScriptCommand}"
                       Padding="8,4"
                       Margin="4,0,0,0"
                       ToolTip="Save script"/>
            <ui:Button Grid.Column="3"
                       Command="{Binding OpenScriptsFolderCommand}"
                       Padding="8,4"
                       Margin="4,0,0,0"
                       ToolTip="Open scripts folder">
                <ui:SymbolIcon Symbol="FolderOpen20" FontSize="16"/>
            </ui:Button>
        </Grid>

        <!-- Engine selector -->
        <Grid Grid.Row="2" Margin="8,0,8,4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0"
                       Text="Engine:"
                       VerticalAlignment="Center"
                       Margin="0,0,8,0"
                       Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
            <ComboBox Grid.Column="1"
                      ItemsSource="{Binding EngineNames}"
                      SelectedIndex="{Binding SelectedEngineIndex}"/>
        </Grid>

        <!-- Code editor -->
        <TextBox Grid.Row="3"
                 Margin="8,4"
                 Text="{Binding ScriptCode, UpdateSourceTrigger=PropertyChanged}"
                 AcceptsReturn="True"
                 AcceptsTab="True"
                 VerticalScrollBarVisibility="Auto"
                 HorizontalScrollBarVisibility="Auto"
                 FontFamily="Consolas"
                 FontSize="12"
                 TextWrapping="NoWrap"
                 SpellCheck.IsEnabled="False"
                 BorderThickness="1"
                 BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"/>

        <!-- GridSplitter -->
        <GridSplitter Grid.Row="4"
                      Height="6"
                      Margin="8,2"
                      HorizontalAlignment="Stretch"
                      Background="{DynamicResource ControlStrokeColorDefaultBrush}"
                      ResizeDirection="Rows"/>

        <!-- Run/Stop buttons -->
        <Grid Grid.Row="5" Margin="8,4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <ui:Button Grid.Column="0"
                       Content="Run Script"
                       Icon="{ui:SymbolIcon Play20}"
                       Command="{Binding RunScriptCommand}"
                       HorizontalAlignment="Stretch"
                       Padding="8,6"
                       Margin="0,0,4,0"
                       Appearance="Primary"/>

            <ui:Button Grid.Column="1"
                       Content="Stop"
                       Icon="{ui:SymbolIcon Stop20}"
                       Command="{Binding StopScriptCommand}"
                       IsEnabled="{Binding IsRunning}"
                       Padding="8,6"
                       Appearance="Danger"/>
        </Grid>

        <!-- Progress bar -->
        <ProgressBar Grid.Row="6"
                     Value="{Binding Progress}"
                     Minimum="0" Maximum="100"
                     Height="4"
                     Margin="8,0,8,4"
                     Visibility="{Binding IsRunning, Converter={StaticResource BoolToVisibilityConverter}}"/>

        <!-- Output log -->
        <Grid Grid.Row="7" Margin="8,0,8,8">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0"
                       Text="Output"
                       Margin="0,0,0,4"
                       FontWeight="SemiBold"
                       Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>

            <TextBox Grid.Row="1"
                     Text="{Binding OutputLog, Mode=OneWay}"
                     IsReadOnly="True"
                     VerticalScrollBarVisibility="Auto"
                     HorizontalScrollBarVisibility="Auto"
                     FontFamily="Consolas"
                     FontSize="11"
                     AcceptsReturn="True"
                     TextWrapping="Wrap"
                     BorderThickness="1"
                     BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"/>
        </Grid>
    </Grid>
</UserControl>
