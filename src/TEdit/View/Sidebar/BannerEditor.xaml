<UserControl x:Class="TEdit.View.BannerEditor"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:viewModel="clr-namespace:TEdit.ViewModel"
        xmlns:converters="clr-namespace:TEdit.Converters"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        mc:Ignorable="d"
        xmlns:p="clr-namespace:TEdit.Properties"
        d:Width="320"
        d:DataContext="{d:DesignInstance Type=viewModel:BannerViewModel}">

    <UserControl.Resources>
        <converters:BannerTallyToPreviewConverter x:Key="BannerTallyToPreviewConverter" />
    </UserControl.Resources>

    <DockPanel Background="{DynamicResource SidebarBackgroundBrush}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">

        <!-- Title -->
        <TextBlock DockPanel.Dock="Top" Text="{x:Static p:Language.sidebar_banner_title}" Style="{DynamicResource SidebarPanelTitle}" />

        <!-- Toolbar -->
        <UniformGrid Columns="4" DockPanel.Dock="Top" Style="{DynamicResource SidebarButtonRow}">
            <ui:Button Content="{x:Static p:Language.banner_import}" Margin="2" Padding="6,4" HorizontalAlignment="Stretch" Command="{Binding ImportBannersCommand}" />
            <ui:Button Content="{x:Static p:Language.banner_save}" Margin="2" Padding="6,4" HorizontalAlignment="Stretch" Command="{Binding SaveBannersCommand}" />
            <ui:Button Content="{x:Static p:Language.banner_maxout}" Margin="2" Padding="6,4" HorizontalAlignment="Stretch" Command="{Binding MaxOutBannersCommand}" />
            <ui:Button Content="{x:Static p:Language.banner_reset}" Margin="2" Padding="6,4" HorizontalAlignment="Stretch" Command="{Binding ResetBannersCommand}" />
        </UniformGrid>

        <!-- Filter bar -->
        <Grid DockPanel.Dock="Top" Margin="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Text="{x:Static p:Language.banner_filter}" VerticalAlignment="Center" Margin="4,0" />
            <TextBox Grid.Column="1" Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}" Margin="2" />
            <TextBlock Grid.Column="2" Text="{x:Static p:Language.banner_category}" VerticalAlignment="Center" Margin="4,0" />
            <ComboBox Grid.Column="3" Width="90" Margin="2"
                      ItemsSource="{Binding Categories}"
                      SelectedItem="{Binding SelectedCategory}" />
        </Grid>

        <!-- Banner list -->
        <ListView
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            Name="BannerReadout"
            ItemsSource="{Binding BannersView}"
            VirtualizingStackPanel.IsVirtualizing="True"
            VirtualizingStackPanel.VirtualizationMode="Recycling">

            <ListView.GroupStyle>
                <GroupStyle>
                    <GroupStyle.HeaderTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="13" Margin="2,4,0,2"
                                       Foreground="{DynamicResource TextBrush}" />
                        </DataTemplate>
                    </GroupStyle.HeaderTemplate>
                </GroupStyle>
            </ListView.GroupStyle>

            <ListView.View>
                <GridView>
                    <!-- Banner Icon -->
                    <GridViewColumn Header="" Width="32">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <Image Source="{Binding TallyIndex, Converter={StaticResource BannerTallyToPreviewConverter}}"
                                       Width="24" Height="24"
                                       RenderOptions.BitmapScalingMode="NearestNeighbor"
                                       Stretch="Uniform" />
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <!-- Banner Name -->
                    <GridViewColumn Width="150" Header="{x:Static p:Language.bestiary_name}" DisplayMemberBinding="{Binding Name}" />

                    <!-- Kill count (read-only) -->
                    <GridViewColumn Header="{x:Static p:Language.banner_kills}" Width="55">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Kills}" Width="40" TextAlignment="Right" />
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <!-- Claimable count (editable) -->
                    <GridViewColumn Header="{x:Static p:Language.banner_count}" Width="55">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBox Width="40" Text="{Binding Count, UpdateSourceTrigger=PropertyChanged}" />
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
        </ListView>

    </DockPanel>

</UserControl>
